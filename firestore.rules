/**
 * @description This ruleset enforces a public read policy for agents, missions, and activity logs, but restricts writes to authenticated users.
 * @dataStructure The database contains three top-level collections: /agents/{agentId}, /missions/{missionId}, and /activity_logs/{logId}.
 * @keySecurityDecisions
 *   - Read access is open to all for all collections.
 *   - Unauthenticated users can `get` and `list` agents, missions, and activity logs.
 *   - Only authenticated users can create, update, or delete documents in any of the collections. No ownership checks are implemented.
 *   - Validation of the data schema is skipped in this prototyping phase for faster iteration.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read agent data, but restricts modifications to authenticated users.
     * @path /agents/{agentId}
     * @allow (get, list) Anyone can read agent data.
     * @allow (create, update, delete) An authenticated user can create, update, or delete agent data.
     * @deny An unauthenticated user cannot create, update, or delete agent data.
     * @principle Allows public reads but enforces authentication for writes.
     */
    match /agents/{agentId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read mission data, but restricts modifications to authenticated users.
     * @path /missions/{missionId}
     * @allow (get, list) Anyone can read mission data.
     * @allow (create, update, delete) An authenticated user can create, update, or delete mission data.
     * @deny An unauthenticated user cannot create, update, or delete mission data.
     * @principle Allows public reads but enforces authentication for writes.
     */
    match /missions/{missionId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows anyone to read activity log data, but restricts modifications to authenticated users.
     * @path /activity_logs/{logId}
     * @allow (get, list) Anyone can read activity log data.
     * @allow (create, update, delete) An authenticated user can create, update, or delete activity log data.
     * @deny An unauthenticated user cannot create, update, or delete activity log data.
     * @principle Allows public reads but enforces authentication for writes.
     */
    match /activity_logs/{logId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}